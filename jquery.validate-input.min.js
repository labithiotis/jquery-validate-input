!function(t){String.prototype.setCharAt=function(t,e,i){return null!=t&&e?""+((t>0?this.substr(0,t):"")+e+this.substr(i?t+i:t+1,this.length)):this.toString()},String.prototype.insertAt=function(t,e){return null!=t&&e?""+this.slice(0,t)+e+this.slice(t+this.length):this.toString()};var e=function(t,e){t._value=t.value,this.$element=$(t),this.value=t._value,this.options={debug:!1,maxLength:60,showMaxLength:"number"==typeof e.maxLength,showMaxLengthSecondary:"maxLength"!=e.type,type:"",symbol:"Â£",allowMetaKeys:!0,postValidateDelay:200,errorClass:"error",addedErrorClass:!0},this.options=$.extend(this.options,e),this.init()};e.prototype={addKeyEvent:function(t){this.$element.off("keypress.validate",t.bind(this)).on("keypress.validate",t.bind(this)),this.$element.off("onkeydown.validate",this.deleteKeys.bind(this)).on("keydown.validate",this.deleteKeys.bind(this))},addChangeEvent:function(t){this.$element.off("change.validate",t.bind(this)).on("change.validate",t.bind(this))},log:function(){if(this.options.debug){var t=Array.prototype.slice.call(arguments);t.unshift("JVI:"),console.log.apply(console,t)}},init:function(){switch(this.options.type){case"numbers":this.validateNumbers();break;case"letters":this.validateLetters();break;case"numbersAndLetters":this.validateNumbersAndLetters();break;case"price":this.validatePrice();break;case"pin":this.validatePin();break;case"phone":this.validatePhone();break;case"percentage":this.validatePercentage();break;case"time":this.validateTime();break;case"maxLength":this.validateMaxLength()}this.options.showMaxLength&&"maxLength"!=this.options.type&&this.validateMaxLength()},test:function(e,i,n){var s=i||this.$element[0]._testRegExp;if(s&&!(!s instanceof RegExp)){var a=e||t.event,l=String.fromCharCode(a.keyCode||a.which);return this.log('"'+l+'"',"key pressed"),this.$element[0]._testRegExp=s,n instanceof Function&&t.setTimeout(function(){n.call(this,a,l)}.bind(this),1),a.metaKey&&this.options.allowMetaKeys?!0:s.test(l)?void 0:(this.log("Invalid key pressed: "+l),a.preventDefault&&a.preventDefault(),a.returnValue=!1)}},postValidate:function(e,i){this.log("Post validate input"),this.options.showMaxLength&&t.setTimeout(this.updateMaxCountIndicator.bind(this),20);var n=!0,s=e||this.$element[0]._postValidateRegExp;if(!s||!s instanceof RegExp){if(i instanceof Function)return i.call(this,n)}else this.$element[0]._postValidateRegExp=s,t.setTimeout(function(){return n=s.test(this.$element.val()),this.options.addedErrorClass&&(n?this.$element.removeClass(this.options.errorClass):(this.log('Input value is invalid: "'+this.$element.val()+'"'),this.$element.addClass(this.options.errorClass))),this.$element[0].setCustomValidity(n?null:"This field has invalid contents!"),i instanceof Function?i.call(this,n):void 0}.bind(this),this.options.postValidateDelay)},deleteKeys:function(e){var i=e||t.event;(8==i.keyCode||46==i.keyCode)&&t.setTimeout(this.postValidate.bind(this),1)},updateMaxCountIndicator:function(){this.log("Max length updateCount, value ==",this.$element[0].value);var t=this.$element[0].value.length;t>=this.options.maxLength&&!this.options.showMaxLengthSecondary?this.$counter.html(this.options.maxLength+"/"+this.options.maxLength).addClass("invalid"):this.$counter.html(t+"/"+this.options.maxLength).removeClass("invalid")},validateMaxLength:function(){function e(e){var n=e||t.event,s=/^(37|38|39|40|46|27|13|8|9|16|17|18|20)$/,a=s.test(n.keyCode);return 0!=i.$element[0].value.substring(n.target.selectionStart,n.target.selectionEnd).length?(i.log("Allow input as it's highlighted text."),t.setTimeout(i.updateMaxCountIndicator.bind(i),20),!0):n.metaKey&&this.options.allowMetaKeys?(t.setTimeout(i.updateMaxCountIndicator.bind(i),20),!0):i.$element[0].value&&i.$element[0].value.length>=i.options.maxLength&&!a?(n.preventDefault&&n.preventDefault(),n.returnValue=!1):void t.setTimeout(i.updateMaxCountIndicator.bind(i),20)}this.log("Add validate max length.");var i=this,n=$('<div class="validate-wrapper" style="position:relative;"></div>'),s=this.$counter=$('<div class="validate-counter">'+this.$element[0].value.length+"/"+this.options.maxLength+"</div>");this.$element.on("blur",function(){this.value=this.value.substr(0,i.options.maxLength)}),this.$element.wrap(n),this.$element.parent().append(s),this.addKeyEvent(e)},validateNumbers:function(){this.log("Add validate numbers."),this.addKeyEvent(function(t){this.test.call(this,t,/[\d]/)})},validateLetters:function(){this.log("Add validate letters."),this.addKeyEvent(function(t){this.test.call(this,t,/[\w]/)})},validateNumbersAndLetters:function(){this.log("Add validate numbers and letters."),this.addKeyEvent(function(t){this.test.call(this,t,/[\w\d]/)})},validatePhone:function(){this.log("Add validate phone."),this.addKeyEvent(function(t){this.test.call(this,t,/[\d\-\+\(\)\s]/,function(){this.postValidate(/^[\+\d\-\(\)]+(?: [\d\-\s]+){0,4}$/gi)})})},validatePin:function(){this.log("Add validate pin."),this.addKeyEvent(function(t){this.test(t,/^[\d]{0,3}$/,function(){this.postValidate(/^[\d]{3}$/)})})},validatePrice:function(){function e(e){var i=e||t.event,n=String.fromCharCode(i.keyCode||i.which),s=i.target.value,a=i.target.selectionStart,l=s.match(/\./gi),o=s.match(/\.(.*)/gi),h=/[\d\.]/;return i.metaKey&&this.options.allowMetaKeys?!0:h.test(n)||n==this.options.symbol?"."==n&&l&&l.length>0?(this.log("Input already has one period"),i.preventDefault&&i.preventDefault(),i.returnValue=!1):s.match(this.options.symbol)&&a<this.options.symbol.length&&37!=i.keyCode&&!(i.target.selectionEnd-i.target.selectionStart>0)?(this.log("Can't insert anything before currency symbol"),i.preventDefault&&i.preventDefault(),i.returnValue=!1):o&&o[0].length>2&&a>=s.length-2||""==s?(this.log("Can only insert pennies to 2 decimal places"),i.target.value=s.setCharAt(a>=s.length?a-1:a,n),$(i.target).one("blur",function(){$(i.target).trigger("change")}),i.preventDefault&&i.preventDefault(),i.returnValue=!1):void 0:(this.log("Invalid key pressed: "+n),i.preventDefault&&i.preventDefault(),i.returnValue=!1)}function i(){var t=this.$element.val().replace(/[^\d\.]+/g,""),e=t.split("."),i=e[0].replace(/^0+/,""),n=e[1]?e[1].length<2?e[1]+"0":e[1]:"";this.$element[0]._value=(""==i?"0":i)+(e[1]?"."+n:".00"),this.$element.val(""==t?"":this.options.symbol+this.$element[0]._value)}function n(){""==this.$element.val()&&this.$element.val(this.options.symbol)}function s(){this.$element.val()==this.options.symbol&&this.$element.val("")}this.log("Add validate price."),this.addKeyEvent(e.bind(this)),this.addChangeEvent(i.bind(this)),i.bind(this).call(),this.$element.on("focus",n.bind(this)),this.$element.on("blur",s.bind(this))},validatePercentage:function(){function t(){var t=this.$element.val().replace("%","");this.$element[0]._value=t,this.$element.val(""==t?"":t+"%")}this.log("Add validate percentage."),this.addKeyEvent(function(t){this.test.call(this,t,/[\d%\.]/)}),this.addChangeEvent(t.bind(this)),t.call(this)},validateTime:function(){function e(e){var n=e||t.event,s=String.fromCharCode(n.keyCode||n.which),l=n.target.value,o=n.target.selectionStart,h=l.match(/:/gi),r=l.match(/:(.*)/gi),d=/[\d]/;return a=l,n.metaKey&&this.options.allowMetaKeys?i(l):void(d.test(s)&&!h&&l.length>=2&&l.length<5?(this.log("Add time divider"),n.target.value=l.insertAt(2,":")):d.test(s)&&l.length>=5?(this.log("Max length for time reached"),n.returnValue=!1,n.preventDefault&&n.preventDefault(),o=2==o?3:o>=5?4:o,n.target.value=i(l.setCharAt(o,s)),n.target.setSelectionRange(o+1,o+1)):(!d.test(s)||r&&r[0].length>2)&&(this.log("Invalid Character pressed"),n.returnValue=!1,n.preventDefault&&n.preventDefault()))}function i(t){for(this.log("Parse time");t.length<4;)t="0"+t;var e,i,n,s,a,l;return e=t.match(/\d/gi),i=(e[0]||0)+(e[1]||0),s=(e[2]||0)+(e[3]||0),i&&i.length>2&&(i=i.substr(0,2)),(i&&0==i.length||!i)&&(i="00"),i&&1==i.length&&(i="0"+i),s&&s.length>2&&(s=s.substr(0,2)),(s&&0==s.length||!s)&&(s="00"),s&&1==s.length&&(s="0"+s),n=i.split(""),a=s.split(""),l=i+":"+s,a[0]>=6&&(l=i+":59"),(n[0]>=3||n[0]>=2&&n[1]>=4)&&(l="23:59"),l}function n(){this.log("Update Value of input");var t=this.$element.val();this.$element[0]._value=t,this.$element.val(""==t?"":i(t))}function s(){this.value!=a&&this.$element.trigger("change")}this.log("Add validate time.");var a=this.value;this.$element.on("blur",s.bind(this)),this.addKeyEvent(e.bind(this)),this.addChangeEvent(n.bind(this)),n.bind(this).call()}},$.fn.validateInput=function(t){return this.each(function(){if(t instanceof Object)return this._validate=new e(this,t),this;var i={type:t};return this._validate=new e(this,i),this}),this}}(window,document,void 0);